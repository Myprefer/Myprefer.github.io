{"title":"FastAPI项目 从构建到部署","uid":"bf51339dcad20c031f2ba03575ee26be","slug":"FastAPI项目-从构建到部署","date":"2024-09-24T09:31:51.000Z","updated":"2024-09-29T10:37:02.858Z","comments":true,"path":"api/articles/FastAPI项目-从构建到部署.json","keywords":null,"cover":[],"content":"<h1 id=\"FastAPI项目-从构建到部署\"><a href=\"#FastAPI项目-从构建到部署\" class=\"headerlink\" title=\"FastAPI项目 从构建到部署\"></a>FastAPI项目 从构建到部署</h1><h2 id=\"项目框架基本结构\"><a href=\"#项目框架基本结构\" class=\"headerlink\" title=\"项目框架基本结构\"></a>项目框架基本结构</h2><p><strong>FastAPI</strong></p>\n<ul>\n<li><p><strong>路由, 视图</strong></p>\n<ul>\n<li>APIRouter</li>\n<li>Include_router</li>\n<li>Jinja2</li>\n</ul>\n</li>\n<li><p><strong>中间件</strong></p>\n<ul>\n<li>cookie</li>\n<li>session</li>\n<li>request, response</li>\n</ul>\n</li>\n<li><p><strong>安全</strong></p>\n<ul>\n<li><strong>JWT</strong></li>\n<li><strong>RBAC</strong></li>\n<li>Depends</li>\n<li>Exception</li>\n</ul>\n</li>\n<li><p><strong>第三方库</strong></p>\n<ul>\n<li>短信</li>\n<li>支付(微信, 支付宝)</li>\n<li><strong>数据库(MySQL, pg)</strong></li>\n<li><strong>缓存(File, Redis)</strong></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"项目架构\"><a href=\"#项目架构\" class=\"headerlink\" title=\"项目架构\"></a>项目架构</h3><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\"></span></span></code></pre></div><h2 id=\"项目基础构建\"><a href=\"#项目基础构建\" class=\"headerlink\" title=\"项目基础构建\"></a>项目基础构建</h2><h3 id=\"事件监听\"><a href=\"#事件监听\" class=\"headerlink\" title=\"事件监听\"></a>事件监听</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_event_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">startup</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> startup</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">application</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_event_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">shutdown</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> stopping</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">application</span><span style=\"color: #89DDFF\">))</span></span></code></pre></div><p>启动时调用<code>startup()</code>函数, 关闭时调用<code>stopping()</code>函数</p>\n<p><code>startup</code>函数:</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">startup</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">app</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> FastAPI</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #BABED8\"> Callable</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    FastApi 启动完成事件</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    :param app: FastAPI</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    :return: start_app</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    </span><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">async</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">app_start</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># APP启动完成后触发</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">启动完毕</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">pass</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> app_start</span></span></code></pre></div><h3 id=\"异常错误处理\"><a href=\"#异常错误处理\" class=\"headerlink\" title=\"异常错误处理\"></a>异常错误处理</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_exception_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">HTTPException</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> http_error_handler</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># http错误 需实现http_error_handler</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_exception_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">RequestValidationError</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> http422_error_handler</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 验证错误 需实现http422_error_handler</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_exception_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">UnicornException</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> unicorn_exception_handler</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 启动错误 需实现unicorn_exception_handler</span></span></code></pre></div><p><code>http_error_handler</code>实现</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">async</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">http_error_handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">_</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> Request</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">exc</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> HTTPException</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    http异常处理</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    :param _:</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    :param exc:</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    :return:</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">    </span><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">JSONResponse</span><span style=\"color: #89DDFF\">(&#123;</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">        </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">code</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> exc</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">status_code</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">        </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> exc</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">detail</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">        </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">data</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> exc</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">detail</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">status_code</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">exc</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">status_code</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h3 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">router </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">APIRouter</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">router</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h3 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_middleware</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">Middleware</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 手动实现session</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># session</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_middleware</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    SessionMiddleware</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">secret_key</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">session</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">session_cookie</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">f_id</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #676E95; font-style: italic\"># max_age=4</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 跨域请求</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">application</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">add_middleware</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    CORSMiddleware</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">allow_origins</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">settings</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CORS_ORIGINS</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">allow_credentials</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">settings</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CORS_ALLOW_CREDENTIALS</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">allow_methods</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">settings</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CORS_ALLOW_METHODS</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">    </span><span style=\"color: #BABED8; font-style: italic\">allow_headers</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">settings</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CORS_ALLOW_HEADERS</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h2 id=\"路由-1\"><a href=\"#路由-1\" class=\"headerlink\" title=\"路由\"></a>路由</h2><ul>\n<li><p>用一个文件来统一管理路由, 避免混乱</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">api_router </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">APIRouter</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/api/v1</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">post</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/test/oath2</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">测试oath2授权</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])(</span><span style=\"color: #82AAFF\">test_oath2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/admin</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">用户管理</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">role</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/admin</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">角色管理</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">access</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/admin</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">权限管理</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">websocket</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/ws</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">WebSocket</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">wechat</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/wechat</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">微信授权</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">sms</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/sms</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">短信接口</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">api_router</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">include_router</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cos</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">router</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">prefix</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/cos</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">对象存储接口</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span></code></pre></div></li>\n<li><p>归类于总结注释:</p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">ApiRouter</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/index</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">api路由</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">summary</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">注册接口</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)(</span><span style=\"color: #82AAFF\">index</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">ApiRouter</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">post</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/login</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">tags</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">api路由</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">summary</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">登陆接口</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)(</span><span style=\"color: #82AAFF\">login</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><p><img src=\"https://raw.githubusercontent.com/Myprefer/ImageHost/main/20240929165137.png\"></p>\n</li>\n<li><p><a href=\"http://127.0.0.1:8000/redoc\">http://127.0.0.1:8000/redoc</a> api文档<br><img src=\"https://raw.githubusercontent.com/Myprefer/ImageHost/main/20240929165445.png\"></p>\n</li>\n</ul>\n<h2 id=\"数据库\"><a href=\"#数据库\" class=\"headerlink\" title=\"数据库\"></a>数据库</h2>","feature":true,"text":"FastAPI项目 从构建到部署项目框架基本结构FastAPI 路由, 视图 APIRouter Include_router Jinja2 中间件 cooki...","permalink":"/post/FastAPI项目-从构建到部署","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#FastAPI%E9%A1%B9%E7%9B%AE-%E4%BB%8E%E6%9E%84%E5%BB%BA%E5%88%B0%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">FastAPI项目 从构建到部署</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">项目框架基本结构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84\"><span class=\"toc-text\">项目架构</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E6%9E%84%E5%BB%BA\"><span class=\"toc-text\">项目基础构建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC\"><span class=\"toc-text\">事件监听</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%82%E5%B8%B8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86\"><span class=\"toc-text\">异常错误处理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B7%AF%E7%94%B1\"><span class=\"toc-text\">路由</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E9%97%B4%E4%BB%B6\"><span class=\"toc-text\">中间件</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B7%AF%E7%94%B1-1\"><span class=\"toc-text\">路由</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">数据库</span></a></li></ol></li></ol>","author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"加入择栖工作室谢谢喵~      学习机器学习谢谢喵~","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"ML 理论基础","uid":"23f2ddd5bdc180cd3f2c05e6b37a137d","slug":"ML-理论基础","date":"2024-09-07T16:31:52.000Z","updated":"2024-09-07T16:32:29.053Z","comments":true,"path":"api/articles/ML-理论基础.json","keywords":null,"cover":[],"text":"理论基础讨论前向传播和反向传播的流程？前向传播 在输入层输入特征向量, 传递到隐藏层 在隐藏层不断计算出每一层神经元得到的结果 通过激活函数得到的输出 将输出传...","permalink":"/post/ML-理论基础","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://gravatar.com/avatar/d195051819ce742212020a79d768fb6c?size=256&cache=1710768150791","link":"https://github.com/Myprefer","description":"加入择栖工作室谢谢喵~      学习机器学习谢谢喵~","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}